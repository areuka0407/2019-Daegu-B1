<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>부산국제영화제</title>
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script src="bootstrap-4.4.1-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="bootstrap-4.4.1-dist/css/bootstrap.css">
    <link rel="stylesheet" href="fontawesome/css/all.css">
    <script src="fontawesome/js/all.js" src="text/javascript"></script>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/common.js" type="text/javascript" defer></script>
</head>
<body>
    <!-- 헤더 영역 -->
    <header>
       <div class="container d-flex justify-content-between align-items-center">
           <a href="index.html" id="logo">
               <img src="images/logo.png" title="부산국제영화제" alt="부산국제영화제" height="80">
           </a>
           <div class="nav">
               <div class="item">
                   <a href="index.html">부산국제영화제</a>
               </div>
               <div class="item">
                   <a href="sub_about.html">영화제 소개</a>
               </div>
               <div class="item active">
                   <a href="req_screen.html">상영 요청</a>
               </div>
               <div class="item">
                   <a href="reserve.html">상영작 예매</a>
               </div>
           </div>
           <div class="sub-nav">
               <a href="login.html" class="item">관리자 접속</a>
           </div>
       </div>
   </header>
    <!-- 비쥬얼 영역 -->
    <div id="visual" class="sub">
        <div>
            <h5>
                <span class="home">BIFF 2020</span>
                <i class="right-icon white"></i>
                Request Screen
            </h5>
            <h3>상영 요청</h3>
        </div>
    </div>
    <!-- 상영 등록 영역 -->
    <div id="request-screen">
        <div class="container">
            <div class="padding">     
                <div class="section-title">
                    <span class="behind">R</span>
                    <h1>Request <span class="accent">FORM</span></h1>
                </div>
                <form id="request-screen-form" class="row" method="post" enctype="multipart/form-data">
                    <div class="col-md-6 col-ms-12">
                        <div class="form-group">
                            <label class="d-inline" for="movie_name">영화명</label>
                            <small class="help-message text-danger"></small>
                            <input type="text" id="movie_name" name="movie_name" class="form-control mt-1">
                        </div>
                        <div class="form-group">
                            <label class="d-inline" for="ceo_phone">영화사 대표 전화번호</label>
                            <small class="help-message text-danger"></small>
                            <input type="text" id="ceo_phone" name="ceo_phone" class="form-control mt-1">
                        </div>
                        <div class="form-group">
                            <label class="d-inline" for="director_name">감독명</label>
                            <small class="help-message text-danger"></small>
                            <input type="text" id="director_name" name="director_name" class="form-control mt-1">
                        </div>
                        <div class="form-group">
                            <label class="d-inline" for="running_time">러닝 타임</label>
                            <small class="help-message text-danger"></small>
                            <input type="text" id="running_time" name="running_time" class="form-control mt-1">
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-12">
                        <div class="form-group">
                            <label class="d-inline" for="company_name">영화사명</label>
                            <small class="help-message text-danger"></small>
                            <input type="text" id="company_name" name="company_name" class="form-control mt-1">
                        </div>
                        <div class="form-group">
                            <label class="d-inline" for="business_id">사업자 등록 번호</label>
                            <small class="help-message text-danger"></small>
                            <input type="text" id="business_id" name="business_id" class="form-control mt-1">
                        </div>
                        <div class="form-group">
                            <label class="d-inline" for="ceo_email">영화사 대표 이메일</label>
                            <small class="help-message text-danger"></small>
                            <input type="text" id="ceo_email" name="ceo_email" class="form-control mt-1">
                        </div>
                        <div class="form-group">
                            <label class="d-inline" for="movie_poster">영화 포스터</label>
                            <small class="help-message text-danger"></small>
                            <div class="custom-file mt-1">
                                <label for="movie_poster" class="custom-file-label"></label>
                                <input type="file" id="movie_poster" name="movie_poster" class="custom-file-input" accept="image/*">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-dark mt-5 px-5 py-2">상영 요청</button>
                </form>

            </div>
        </div>
    </div>
    <script defer>
        const $ = (s) => document.querySelector(s);
        window.onload = function(){
            const form = $("#request-screen-form");
            const business_id = $("#business_id");
            const ceo_email = $("#ceo_email");
            const ceo_phone = $("#ceo_phone");
            const running_time = $("#running_time");
            const movie_poster = $("#movie_poster");

            form.addEventListener("submit", async e => {
                e.preventDefault();
                
                let result = true;
                // 사업자 등록 번호
                result &= /^[0-9]{3}-[0-9]{2}-[0-9]{5}$/.test(business_id.value) ? 
                        error(business_id, "") 
                        : error(business_id, " 올바른 형태의 사업자등록번호가 아닙니다.");
                
                // 대표 이메일
                result &= /^[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[a-zA-Z]{2,4}$/.test(ceo_email.value) ? 
                        error(ceo_email, "") 
                        : error(ceo_email, " 올바른 형태의 이메일이 아닙니다.");

                // 대표 전화번호
                result &= /^[0-9]{3}-[0-9]{4}-[0-9]{4}$/.test(ceo_phone.value) ? 
                        error(ceo_phone, "") 
                        : error(ceo_phone, " 올바른 형태의 전화번호가 아닙니다.");

                // 러닝 타임 (분 기준)
                result &= /^[0-9]+$/.test(running_time.value) ? 
                        error(running_time, "") 
                        : error(running_time, " 올바른 형태의 러닝타임이 아닙니다.");

                // 포스터 이미지
                let file = movie_poster.files;
                if(!file || !file[0]) result &= error(movie_poster, "올바른 형태의 이미지 파일이 아닙니다."); // 이미지가 업로드 되지 않았을 경우
                else {
                    file = file[0];

                    let img = await(function(){
                        return new Promise(res => {
                            // 이미지가 로딩에 성공하면 올바른 이미지라고 판단
                            let img = document.createElement("img");
                            img.src = URL.createObjectURL(file);

                            img.onload = () => res(img);
                            img.onerror = () => res(false);
                        });
                    })();

                    result &= img ? error(movie_poster, "") : error(movie_poster, " 올바른 형태의 이미지 파일이 아닙니다.");
                }
                
                if(result){ 
                    form.submit();
                }
            }); 

            function error(target, message){
                let $message = target.previousElementSibling;
                $message = !$message || !$message.classList.contains("help-message") ? target.parentElement.previousElementSibling : $message;
                $message.innerText = message;
                return message === "";
            }
        };
    </script>
    <footer>
        <div class="container py-5">
            <div class="row align-items-start">
                <div class="col-md-3">
                    <a href="index.html">
                        <img src="./images/Wlogo.png" title="부산국제영화제" alt="부산국제영화제" height="80">
                    </a>
                </div>
                <div class="links col-sm-12 col-md-3">
                    <h5 class="title">바로가기</h5>
                    <div class="list">
                        <div class="item">
                            <i class="right-icon white"></i>
                            <a href="index.html">부산국제영화제</a>
                        </div>
                        <div class="item">
                            <i class="right-icon white"></i>
                            <a href="sub_about.html">영화제 소개</a>
                        </div>
                        <div class="item">
                            <i class="right-icon white"></i>
                            <a href="req_screen.html">상영 요청</a>
                        </div>
                        <div class="item">
                            <i class="right-icon white"></i>
                            <a href="reserve.html">상영작 예매</a>
                        </div>
                    </div>
                </div>
                <div class="sotial col-sm-12 col-md-3">
                    <h5 class="title">공유하기</h5>
                    <div class="list">
                        <div class="item">
                            <img src="images/sotials/W-facebook.png" alt="페이스북으로 공유하기" title="페이스북으로 공유하기" height="30">
                            <span>페이스북으로 공유하기</span>
                        </div>
                        <div class="item">
                            <img src="images/sotials/W-twitter.png" alt="트위터로 공유하기" title="트위터로 공유하기" height="30">
                            <span>트위터로 공유하기</span>
                        </div>
                        <div class="item">
                            <img src="images/sotials/W-google.png" alt="구글플러스로 공유하기" title="구글플러스로 공유하기" height="30">
                            <span>구글플러스로 공유하기</span>
                        </div>
                    </div>
                </div>
                <div class="other col-sm-12 col-md-3">
                    <h5 class="title">문의하기</h5>
                    <div class="item">
                        전화 1688-3010<br>
                        팩스 051-709-2299
                    </div>
                    <h5 class="title mt-3">오시는 길</h5>
                    <div class="item">
                        부산사무국(48058) 부산시 해운대구 수영강변대로 120
                        영화의전당 비프힐 3층 
                    </div>
                </div>
            </div>
        </div>
        <div class="copy-right">
            ⓒ Busan International Film Festival
        </div>
    </footer>
</body>
</html>